{% extends 'layouts/eg-layout.html' %}

{% block body %}
{% raw %}

<div ng-controller="KineticGraphCtrl">
    <h1>Risk Aversion and Certainty Equivalence</h1>
    <hr/>
    <div class="row">
        <div class="col-md-8">
            <div id="utility"></div>
        </div>
        <div class="col-md-4">
            <div class="well">
                <div class="row">
                    <div class="col-xs-3" style="text-align:right;font-size:12pt;padding-top:10px">Risk Aversion:
                    </div>
                    <div class="col-xs-9" id="rraSlider"></div>
                </div>
                <div class="row">
                    <div class="col-xs-3" style="text-align:right;font-size:12pt;padding-top:10px">Probability of <span class="math">c_L</span>:
                    </div>
                    <div class="col-xs-9" id="pLowSlider"></div>
                </div>
            </div>
            <toggle param="showCE" class="riskPremium"><span ng-if="params.showCE">Hide</span><span ng-if="!params.showCE">Show</span> certainty equivalent (CE)</toggle>
            <toggle param="showRP" class="riskPremium"><span ng-if="params.showRP">Hide</span><span ng-if="!params.showRP">Show</span> risk premium (RP)</toggle>
        </div>
    </div>
</div>
<script>

    var expectedUtilityPoint = {
                    type: 'KG.Point',
                    definition: {
                        name: 'expectedUtilityPoint',
                        className: 'riskPremium',
                        coordinates: {
                            x: 'model.expectedC',
                            y: 'model.expectedU'
                        },
                        droplines: {
                            horizontal: "\\mathbb{E}[u(c)]"
                        }
                    }
                },
                expectedConsumptionPoint = {
                    type: 'KG.Point',
                    definition: {
                        name: 'expectedConsumptionPoint',
                        className: 'expectedUtility',
                        coordinates: {
                            x: 'model.expectedC',
                            y: 'model.utilityOfExpectedC'
                        },
                        droplines: {
                            vertical: "\\mathbb{E}[c]",
                            horizontal: "u(\\mathbb{E}[c])"
                        }
                    }},
                certaintyEquivalentPoint = {
                    type: 'KG.Point',
                    definition: {
                        name: 'certaintyEquivalentPoint',
                        className: 'riskPremium',
                        show: this.show.ce,
                        coordinates: {
                            x: 'model.certaintyEquivalent',
                            y: 'model.expectedU'
                        },
                        droplines: {
                            vertical: "CE"
                        }
                    }},
                expectationSegment = {
                    type: 'KG.Segment',
                    definition:{
                        name: 'expectationSegment',
                        className: 'growth dotted',
                        a: {
                            x: 'model.ca',
                            y: 'model.ua'
                        },
                        b: {
                            x: 'model.cb',
                            y: 'model.ub'
                        },
                    }},

                riskPremiumSegment = {
                    type: 'KG.Segment',
                    definition:{
                        name: 'xDiffSegment',
                        className: 'riskPremium',
                        show: this.show.rp,
                        a: {
                            x: 'model.expectedC',
                            y: 'model.expectedU'
                        },
                        b: {
                            x: 'model.certaintyEquivalent',
                            y: 'model.expectedU'
                        },
                        label: {
                            text: 'RP',
                            valign: 'top'
                        }
                    }};
    var scopeDefinition = {
        params: {
            rra: 0.8,
            pLow: 0.5,
            ca: 20,
            cb: 80,
            showCE: false,
            showRP: false
        },
        graphParams: ['rra'],
        restrictions: [
            {
                expression: 'params.ca',
                restrictionType: 'range',
                min: 1,
                max: 'params.cb'
            },
            {
                expression: 'params.cb',
                restrictionType: 'range',
                min: 'params.ca',
                max: 100
            }
        ],
        model: {
            type: 'EconGraphs.RiskAversion',
            definition: {
                ca: 'params.ca',
                cb: 'params.cb',
                pLow: 'params.pLow',
                utilityType: 'ConstantRRA',
                utilityDef: {
                    rra: 'params.rra'
                },
                show: {
                    ce: 'params.showCE',
                    rp: 'params.showRP'
                }
            }

        },
        views: [
            {
                type: 'KG.Graph',
                definition: {
                    element_id: 'utility',
                    xAxisDef: {min: 0, max: 100, title: '\\text{Consumption (units)}', ticks: 0},
                    yAxisDef: {min: 0, max: 'model.utility.utilityAtQuantity(100)', title: '\\text{Total Utility (utils)}', ticks: 0},
                    objects: [
                        'model.utility.utilityFunctionView',
                        'model.utility.utilityAtQuantityPoint(params.ca, {name: "CL", xAxisLabel: "c_L", yAxisLabel: "u(c_L)", xDrag: "params.ca"})',
                        'model.utility.utilityAtQuantityPoint(params.cb, {name: "CH", xAxisLabel: "c_H", yAxisLabel: "u(c_H)", xDrag: "params.cb"})',
                        expectedUtilityPoint,
                        model.certaintyEquivalentPoint,
                        model.expectedConsumptionPoint,
                        model.expectationSegment,
                        model.riskPremiumSegment
                    ]
                }
            },
            {
                type: 'KG.Slider',
                definition: {
                    element_id: 'rraSlider',
                    param: 'rra',
                    precision: '0.01',
                    axisDef: {min: 0, max: 2, ticks: 0}
                }
            },
            {
                type: 'KG.Slider',
                definition: {
                    element_id: 'pLowSlider',
                    param: 'pLow',
                    precision: '0.01',
                    axisDef: {min: 0, max: 1, tickValues: [0, 0.5, 1]}
                }
            }

        ]
    }
</script>
{% endraw %}
{% endblock %}