{% extends 'layouts/econgraphs.html' %}

{% block body %}
    {% raw %}

    <div ng-controller="KineticGraphCtrl">
        <h1>Utility and Marginal Utility</h1>
        <hr/>
        <div class="row">
            <div class="col-md-8">
                <div id="utility"></div>
            </div>
            <div class="col-md-4">
                <div class="well">
                    <div class="row">
                        <div class="col-xs-4" style="text-align:right;font-size:12pt;padding-top:10px">Risk Aversion :
                        </div>
                        <div class="col-xs-8" id="rraSlider"></div>
                    </div>
                </div>
                <hr>
                <equation class="big" style="color: {{ color('growth') }}">\sigma = {{ (1/(params.rra)) | extendedReal:2 }}</equation>
                <hr/>
                <equation class="big">u(c) = \frac{c^{1 - 1/\color{
                    {{color('growth')}} }{\sigma}} - 1}{1 - 1/\color{
                    {{color('growth')}} }{\sigma}} || = {{ model.utilityFormula()}}
                </equation>
                <hr/>
                <equation class="big">u(c_A) = {{ model.utilityFormula(params.c)}} || = {{
                    model.utilityAtQuantity(params.c) | number: 2}}
                </equation>
            </div>
        </div>
    </div>

    {% endraw %}
{% endblock %}

{% block model %}
    <script>
    var scopeDefinition = {
            params: {
                rra: 1.5,
                c: 2
            },
            graphParams: ['rra'],
            restrictions: [
                {
                    expression: 'params.c',
                    restrictionType: 'range',
                    min: 1,
                    max: 10
                }
            ],
            model: {
                type: 'EconGraphs.ConstantRRA',
                definition: {
                    rra: 'params.rra'
                }
            },
            views: [
                {
                    type: 'KG.Slider',
                    definition: {
                        element_id: 'rraSlider',
                        param: 'rra',
                        precision: '0.01',
                        axisDef: {min: 0, max: 2, tickValues: [0, 1, 2]}
                    }
                }

            ]
        }
    </script>
{% endblock %}

{% block js %}
    <script>
        
        var utilityFunctionView = {
                type: 'KG.FunctionPlot',
                definition: {
                    name: 'utilityFunction',
                    className: 'utility',
                    fn: 'model.utilityFunction',
                    label: {
                        text: 'u(c)'
                    },
                    numSamplePoints: 201
                }
            },
            marginalUtilityFunctionView = {
                type: 'KG.FunctionPlot',
                definition: {
                    name: 'utilityFunction',
                    className: 'demand',
                    fn: 'model.marginalUtilityFunction',
                    label: {
                        text: "u'(c)"
                    },
                    numSamplePoints: 201
                }
            },
                utilityHorizontalLabel = {
                    type: 'KG.HorizontalDropline',
                    definition: {
                        name: 'uLabel',
                        className: 'utility',
                        coordinates: {x: 'params.c', y: 'model.utilityAtQuantity(params.c)'},
                        axisLabel: "u(c)"
                    }
                },
            utilityPoint = {
                type: 'KG.Point',
                definition: {
                    name: 'utilityAtQ',
                    className: 'utility',
                    coordinates: {x: 'params.c', y: 'model.utilityAtQuantity(params.c)'},
                    droplines: {
                        vertical: 'c'
                    },
                    interaction: {
                        xDrag: 'params.c',
                        highlight: 'c'
                    }
                }
            },
            marginalUtilitySlopeLine = {
                type: 'KG.Line',
                definition: {
                    name: 'marginalUtilityAtQuantitySlope',
                    className: 'demand dotted',
                    lineDef: {
                        point: {x: 'params.c', y: 'model.utilityAtQuantity(params.c)'},
                        slope: 'model.marginalUtilityAtQuantity(params.c)',
                        xDomainDef: {
                            min: 'params.c - 1',
                            max: 'params.c + 1'
                        }
                    },
                    label: {
                        text: "\\text{slope }=u'(c)",
                        align: 'right'
                    },
                    interaction: {
                        highlight: 'mu'
                    }
                }
            },
            marginalUtilityPoint = {
                type: 'KG.Point',
                definition: {
                    name: 'marginalUtilityAtQ',
                    className: 'demand',
                    coordinates: {x: 'params.c', y: 'model.marginalUtilityAtQuantity(params.c)'},
                    droplines: {
                        vertical: 'c'
                    },
                    interaction: {
                        xDrag: 'params.c',
                        highlight: 'c',


                    }
                }
            },
                marginalUtilityHorizontalLabel = {
                    type: 'KG.HorizontalDropline',
                    definition: {
                        name: 'muLabel',
                        className: 'demand',
                        coordinates: {x: 'params.c', y: 'model.marginalUtilityAtQuantity(params.c)'},
                        interaction: {
                            highlight: 'mu'
                        },
                        axisLabel: "u'(c)"
                    }
                }

    </script>

    {% block extends_crra_controls %}
        <script>
        scopeDefinition.views.push({
                    type: 'KG.TwoVerticalGraphs',
                    definition: {
                        element_id: 'utility',
                        xAxisDef: {min: 0, max: 10, title: '\\text{Consumption (units)}'},
                        topGraph: {
                            yAxisDef: {min: 0, max: 'model.utilityAtQuantity(10)', title: '\\text{Total Utility (utils)}'},
                            objects: [utilityFunctionView, utilityHorizontalLabel, utilityPoint, marginalUtilitySlopeLine]
                        },
                        bottomGraph: {
                            yAxisDef: {min: 0, max: 1, title: '\\text{Marginal Utility (utils/unit)}'},
                            objects: [marginalUtilityFunctionView, marginalUtilityHorizontalLabel, marginalUtilityPoint]
                        },
                        objects: []
                    }
                })
        </script>
    {% endblock %}

    <script src="{{ url_for('static', filename='js/kg/kg-v0.02.js') }}"></script>

{% endblock %}